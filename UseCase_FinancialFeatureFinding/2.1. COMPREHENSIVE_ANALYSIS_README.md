# Comprehensive SAE Layer Analysis Report

## Overview
This report contains a comprehensive analysis of Sparse Autoencoder (SAE) models across 5 layers (4, 10, 16, 22, 28) comparing Llama-2-7B base model vs FinLLama-7B fine-tuned model.

## Analysis Date
2025-08-31 21:47:55

## Layers Analyzed
- Layer 4
- Layer 10  
- Layer 16
- Layer 22
- Layer 28

## Key Findings

### Overall Model Similarity

- **Average Encoder Correlation**: 0.4388 (43.9%)
- **Average Decoder Correlation**: 0.2792 (27.9%)
- **Overall Model Similarity**: 35.9%

### Feature Drift Summary

- **Total Stable Features**: 167 (8.3%)
- **Total Moderate Drift Features**: 362 (18.1%)
- **Total High Drift Features**: 1471 (73.6%)

## Layer-by-Layer Analysis

### Layer 4
- **Encoder Correlation**: 0.4602
- **Decoder Correlation**: 0.2628
- **Mean Drift**: 1.1999
- **Feature Distribution**:
  - Stable: 21 (5.2%)
  - Moderate: 73 (18.2%)
  - High Drift: 306 (76.5%)


### Layer 10
- **Encoder Correlation**: 0.4909
- **Decoder Correlation**: 0.2950
- **Mean Drift**: 1.1797
- **Feature Distribution**:
  - Stable: 28 (7.0%)
  - Moderate: 78 (19.5%)
  - High Drift: 294 (73.5%)


### Layer 16
- **Encoder Correlation**: 0.4587
- **Decoder Correlation**: 0.2540
- **Mean Drift**: 1.2009
- **Feature Distribution**:
  - Stable: 40 (10.0%)
  - Moderate: 54 (13.5%)
  - High Drift: 306 (76.5%)


### Layer 22
- **Encoder Correlation**: 0.4308
- **Decoder Correlation**: 0.3131
- **Mean Drift**: 1.1472
- **Feature Distribution**:
  - Stable: 45 (11.2%)
  - Moderate: 83 (20.8%)
  - High Drift: 272 (68.0%)


### Layer 28
- **Encoder Correlation**: 0.3535
- **Decoder Correlation**: 0.2711
- **Mean Drift**: 1.1831
- **Feature Distribution**:
  - Stable: 33 (8.2%)
  - Moderate: 74 (18.5%)
  - High Drift: 293 (73.2%)


## Files Generated

### Data Files
- `comprehensive_layer_analysis.json` - Complete analysis results
- `layer_analysis_summary.csv` - Summary table in CSV format
- `layer_analysis_summary.html` - Summary table in HTML format
- `cross_layer_feature_analysis.json` - Cross-layer feature behavior analysis

### Visualizations
- `comprehensive_layer_analysis.png` - Comprehensive visualization of all layers
- Individual layer visualizations (if generated)

## Interpretation

### What the Results Mean
1. **Low Correlations**: Indicate significant fine-tuning with financial data
2. **High Feature Drift**: Shows major reorganization of feature representations
3. **Layer Differences**: Different layers may specialize in different aspects of language

### Feature Categories
- **Stable Features (< 0.5 drift)**: Preserved knowledge from base model
- **Moderate Drift (0.5-1.0)**: Partially modified features
- **High Drift (â‰¥ 1.0)**: Completely reorganized features for financial domain

## Usage

### Running the Analysis
```bash
python comprehensive_layer_analysis.py
```

### Accessing Results
- Check the generated CSV/HTML files for tabular data
- View the PNG file for visualizations
- Use the JSON files for programmatic access to results

## Technical Details

### Model Configuration
- Base Model: meta-llama/Llama-2-7b-hf
- Fine-tuned Model: cxllin/Llama2-7b-Finance
- SAE Configuration: 400 latents, k=32, expansion_factor=32
- Training Data: WikiText-103

### Analysis Methodology
- Feature drift calculated using normalized vector distances
- Correlations computed on flattened weight matrices
- Feature categorization based on drift thresholds
- Cross-layer analysis for consistent behavior patterns

---
*Generated by Comprehensive SAE Layer Analyzer*
